% \documentclass[a4paper,10pt]{jbook}
\documentclass[a4paper,10pt]{jreport}
% \documentclass[a4paper,10pt]{jarticle}
\usepackage{listings,jlisting}
\usepackage[dvipdfmx]{graphicx,color}

% \usepackage[margin=12.7truemm]{geometry}    %% 上下左右のマージン指定
\usepackage[top=10truemm,margin=12.7truemm]{geometry}    %% 上下左右のマージン指定
\usepackage{fancyhdr}                       %% ヘッダ・フッタの編集用
% \usepackage{eclbkbox} % breaklinesとかかな

\usepackage{amsmath,amssymb}
\usepackage{mathtools}
% \mathtoolsset{showonlyrefs=true} %式番号

\usepackage{verbatim} %枠で囲う

% \renewcommand{\thesection}{\arabic{section}} %sectionを調整
% \renewcommand{\thesubsection}{(\arabic{subsection})} %subsectionを調整
% \renewcommand{\thesubsubsection}{\arabic{subsubsection}} %subsubsectionを調整

%%==== ソースコードのレイアウト
\lstset{%
	language=[x86masm]Assembler,
	breaklines=true,%改行
	numbers=left,%
	numberstyle={\scriptsize},%
	stepnumber=1,
	numbersep=1zw,%
	lineskip=-0.5ex,%
	basicstyle=\ttfamily\footnotesize\fontsize{8}{8},
	frame=single,%
	columns=[l][l]{fullflexible},
	tabsize=4,
	xleftmargin=3zw,
	xrightmargin=4zw,
	framexleftmargin=3zw, %ソースの左枠に行番号
	commentstyle={\ttfamily \color[rgb]{0,0.5,0}},
	keywordstyle={\bfseries \color[rgb]{1,0,0}},
	stringstyle={\ttfamily \color[rgb]{0,0,1}},
	literate= %特殊文字
		*{\#include}{{\textcolor[rgb]{0.7,0.3,0.5}{\#include}}}{7}
		 {\#define} {{\textcolor[rgb]{0.7,0.3,0.5}{\#define}}}{6}
		 {\#if}     {{\textcolor[rgb]{0.7,0.3,0.5}{\#if}}}{2}
		 {\#else}   {{\textcolor[rgb]{0.7,0.3,0.5}{\#else}}}{4}
		 {\#endif}  {{\textcolor[rgb]{0.7,0.3,0.5}{\#endif}}}{5}
		 {\#elif}   {{\textcolor[rgb]{0.7,0.3,0.5}{\#elif}}}{4}
		 {\#ifndef} {{\textcolor[rgb]{0.7,0.3,0.5}{\#ifndef}}}{6}
		 {\#ifdef}  {{\textcolor[rgb]{0.7,0.3,0.5}{\#ifdef}}}{5}
		 {move}     {{\textcolor[rgb]{1,0,0}{move}}}{4}
		 {jpne}     {{\textcolor[rgb]{1,0,0}{jpne}}}{4}
		 {halt}     {{\textcolor[rgb]{1,0,0}{halt}}}{4},
}

\begin{titlepage}
	\title{データベースの超初級}
	\author{Hukanzen}
	\date{\today}
	
\end{titlepage}

\begin{document}
\maketitle

\tableofcontents % 目次の表示

\chapter{はじめに}
本書は若造も良いところの，未熟ポンコツ学生が教科書\footnote{問題があれば，教えてください(震え)．}の内容を削りつつ，自分なりにわかりやすく記述する．そのため，当然間違いや，歯抜けもあるだろうが，その時は，指摘してくれると有難い\footnote{当て字をよく使うので，お見苦しければ，指摘してください．}．
特に，SQLにおける概念も合わせて，説明する．
\par 本書の用途としては，自分の振り返りや後輩等への教育，データベースに対するイメージ付け程度である．そのため，本書を理解したからと言って，データベースが完璧なわけではないし，本書がさっぱりわからないからと言って，データベースから遠ざかったりしないで欲しい．
特に，リレーショナルデータベースなどは，数学の集合論に基づいて作成されている．そのため，当たり前のことだが，集合論に対する理解や知識が，最低限必要となってくる．しかし，高専3年や大学1年生といった，若造は，集合論の概念はなかなかハードルが高く，存在自体知らない場合もある．
そこで，本書では極力数学的な知識を必要とせず，表や図を用いて説明を行い，補助的に数学を用いる程度に留める．
もし，数学などを通じた理論を必要として，本書を見つけたのなら，即刻引き返して欲しい．おそらく，数学とデータベースの関連に気付いている人にとっては，まったくの無価値であろう．
\par そのような中身のないものであっても，これを用いて，データベースを周知させることは大切であると考える．
世の中には，馬鹿げた話であるが，中規模で大量のデータのやり取りを行う場合でも，頑なにファイル保存から離れない開発者も存在する．データというものは，組織体にとって，共有資源であり，管理し，様々な場所に使用することに価値がある．1つのプログラムに束縛されたデータなど，それは只の呪縛でしかないのだ．
たまに，Microsoft Excelで全ての名簿や情報を取得し，管理した気になっている長がいる．何故かそういうファイルには既に消えた人の情報が根強く残っており，ふと他人が管理しようとすると，「この人まだいますか」などという会話を繰り広げることになる．
また，新規追加や編集を行う場合でも，謎のVBAや参照で固めており，周りのデータに合わせてユーザが調整しなければならない．表計算ソフトは表計算ソフトであり，データベースではないのだ．数件ならば，まだいいが，本格的に数十件単位になると，非常に不便である．
だが，そもそも何故このような状況が発生するのだろうか．それは，そもそもデータベースの存在や動作を知らないことにある．たしかに，パイプラインなどで一瞬でデータを保存できるのに対して，データベースはそもそもDBMSのインストールや使い方の勉強から始まる．
\par しかし，よく考えて欲しい，データベースに保存した場合の利便性，拡張性を．もし，複数のプログラムでデータを共有するときに，いちいちディレクトリ構造やシンボリックリンクを考えて，ファイルを置かなくてもよい．不十分なファイル移動や管理によって，データの矛盾に悩まされなくても良い．大量のExcelから，指定の場所をみつけて，行や列の挿入をしなくても良い．恐らくだが，人生単位で考えると，数日ぐらいは浮くだろう．
これらの利点を新たな人材，人財に周知することで，人類は，不要なデータの管理から，解放されることを望む．そこで，まずは非常に初歩的な部分のみを，周知することで，データベースに対する不安や恐怖を，信頼や好奇心に変換したい．本書はその部分，いわゆるデータベースに対する「取っ掛かり」部分を補助することを目標とする\footnote{深夜に書いているため，統一性がないかも．}．
\par 繰り返すが，本書は，あくまで，データベースに対する印象づけや，感覚を養う程度であり，理論に関しては，全く役に立たないことを御理解頂きたい．

% 集合
% 部分集合
% 真部分集合

\chapter{データベースとは}
\label{cha:データベースとは}
% 教科書第1章周辺
% \section{データベース}
データベース\footnote{DataBase}とは，コンピュータ内に構築された「実世界の写し絵」である．実世界のものを，データモデル\footnote{記号系}を用いて，データモデリング\footnote{実世界のデータ化する過程}することで，データベースを作成することができる．
そして，データベース管理システムを用いて，データを管理\footnote{取得，挿入，更新など}する．
\par 用語としての「データベース」は主に，2つの意味を持つ．
\begin{itemize}
	\item コンテンツとしてのデータの格納庫
	\item Oracle，MySQL，PostgreSQLなどの，データベース管理システム
\end{itemize}
\par しかし，それをいうと，Google等で検索できるインターネットの情報は，地球規模のデータベースになってしまう．原義を考えると「データの基地」なので，ケースバイケースで読み取ろう．

\section{データモデル}
% \subsection{データモデル}
\par 現在，データモデルには，大きく分けると3つ存在する．これらは世代ごとに順になっている．
\begin{description}
	\item[第1世代] ネットワーク・データモデル，ハイアラキカル・データモデル
	\item[第2世代] リレーショナル・データモデル\footnote{関係モデル，RDB}
	\item[第3世代] オブジェクト指向・データモデル
\end{description}
一般的には，リレーショナル・データモデルに基づいた，リレーショナル・データベース\footnote{関係データベース}が広く使われおり，講義で行う内容もリレーショナル・データベース中心であることが多い．
\par 第1世代は，1960年代当時のコンピュータ事情に即して，考案された．親子集合とレコード型の要素を用いており，レコードとレコードは，ポインタで関連付けられる．そのため，細かなデータを得る場合は，繰り返し親から子に辿る必要があり，非効率である．
\par 第2世代は，徹底的にフォーマルなデータモデルであり，数学の集合論に基づいて作成されてる．全てのデータを表で管理し，リレーショナル代数やリレーショナル論理を用いて，データ集合を得る．従って，ポインタやレコードの実装技術などとは，全く無関係である．なお，用語として，行を示すことを「レコード」と呼ぶことがあるが，恐らく間違った使い方である．
\par 第3世代は，CAD等のエンジニアリングデータやマルチメディアデータ，文書や図版が入り混じった文書データなどの部品展開構造を持つ，複合オブジェクトを表現するのに向いている．
\par 以上より，実世界では同じ内容でも，データモデルの違いにより，異なって表現される．本来は，データベースに格納するデータに合わせて，それに適したデータモデルを使うべきである．しかしながら，一般的には，リレーショナル・データモデルで全て解決させてしまうことが多い．

\section{データベース管理システム}
% \subsection{データベース管理システム}
データベース管理システム\footnote{DataBase Management System}とは，データベースに存在するデータを「管理」するシステムである．商用，オープンソースでは，Oracle，SQL Server，PostgreSQL，MySQL，Maria DBなどを指す．本書では，主にPostgreSQL，補助的にMySQLについて述べる．
通常，OS\footnote{Operating System}の力を借りて，その上で稼働するミドルウェアである．基本的に，次に示す3つの機能を有する．
\begin{itemize}
	\item メタデータ管理機能
	\item 質問処理機能
	\item トランザクション管理機能
\end{itemize}
\par メタデータ管理機能とは，「データのデータ」としてのメタデータを管理する．データベースのデータ構造などを管理するデータでありそのデータの管理を行う．
ユーザとDBMSそのものに対して用いられる．ユーザに対して中にどのようなデータがどのように格納されているかを示す．DBMSに対しては，自分が管理しているデータの種類，サイズ，インデックス，アクセス件など，基本的な情報提供に不可欠なものである．
\par 質問処理機能とは，文字通り，ユーザやアプリケーションが要求する「質問」に対し，処理を行う．特にリレーショナル・データベースでは，SQLに代表される，質問言語を用いる．
\par トランザクションとは，DBMSに対するアプリケーションレベルの仕事の単位である．障害時回復，同時実行制御の2つの機能を有しており，一貫性の保持や，複数人の同時実行を行う．

\section{ファイルとの相違}
% \subsection{データベースとファイルの違い}
データベースに比較して，プログラムごとにデータをファイル保存する手法がある．C言語ならば，FILE構造体を用いて，fprintf()，fscanf()関数などで，ファイルに対して入出力を行える．
しかし，この場合だと，データはプログラムに従属する形になり，無秩序になりがちである．また，データ形式の違いから，同じデータを複数保存したり，プログラムによるアクセスのタイミングから矛盾が発生することがある．
また，近年は，Microsoft Excelなどの高機能な表計算ソフトの登場により，表計算ソフトをデータ保存に用いている場合も有る．この場合，一見，完璧に一元管理が可能なように見えるが，異なるファイルに対しては，同様に矛盾が発生しやすく，一元管理がなされないことが多い．
\par データベースに関しては，DBMSを用いることで，決まった形にデータを保存することが可能である．また，全てのプログラムから1つのデータベースにアクセスすることで，重複や矛盾を排除し，データを一元管理することができる．データは共有資源にすることに意味があり，様々なプログラムからのアクセスに，対応させることは必須である．

% chapterデータベースとは (end)

\chapter{リレーショナルデータモデル} % (fold)
\label{cha:リレーショナルデータモデル}
\section{構造記述}
リレーションとはなんであるか．実世界のデータ構造記述の拠り所であり，リレーションは，様々な概念で構成される．SQLにおいては，テーブルが相当する．リレーションの定義について，表\ref{tbl:リレーションのサンプル}~表\ref{tbl:友人}を用いて説明する．

\begin{table}[htp]
	\begin{center}
		\begin{tabular}{c}
			\begin{minipage}{0.5\hsize}
				\begin{center}
					\caption{リレーションのサンプル}
					\label{tbl:リレーションのサンプル}
					\begin{tabular}{|c|c|c|} \hline
						数字 & 英字 & 平仮名 \\ \hline \hline
						1 & a & あ \\ \hline
						1 & a & い \\ \hline
						1 & b & あ \\ \hline
						1 & b & い \\ \hline
						1 & c & あ \\ \hline
						1 & c & い \\ \hline
						2 & a & あ \\ \hline
						2 & a & い \\ \hline
						2 & b & あ \\ \hline
						2 & b & い \\ \hline
						2 & c & あ \\ \hline
						2 & c & い \\ \hline
					\end{tabular}
				\end{center}
			\end{minipage}
			\begin{minipage}{0.5\hsize}
				\begin{center}
					\caption{友人}
					\label{tbl:友人}
					\begin{tabular}{|c|c|}\hline
						Name & Age \\ \hline \hline
						太郎 & 25 \\ \hline
						一郎 & 30 \\ \hline
						花子 & 26 \\ \hline
						桃子 & 22 \\ \hline
					\end{tabular}
				\end{center}
			\end{minipage}
		\end{tabular}
	\end{center}
\end{table}

\subsection{ドメイン}
ドメインの別名は，定義域と言われる．プログラミング言語には，INTEGER，CHARACTER，FLOATなどのデータ型が存在する．それを元に，定義された集合である．例として，$D_1=INTEGER$ ，$D_2=VARCHAR(1)$などと定義できる．
% PostgreSQLにおける，データ型の例
\subsection{直積}
\par 次に，ドメインからなる直積を求める．ドメイン
\begin{equation}
	D_1=\{x|x=1,2\},D_2=\{c|c=a,b,c\},D_3=\{s|s=あ,い\}
\end{equation}
	とする．このとき，$D_1 \times D_2 \times D_3$を求めると，次のような12個の要素が得られる．
\begin{equation}
	\{(1,a,あ),(1,a,い),(1,b,あ),...,(2,c,あ),(2,c,い)\}
\end{equation}
この直積集合の各要素を組\footnote{タプル，タップル，tuple}という．
\par そして，ドメイン$D_1$，$D_2$，$D_3$を用いた部分集合，リレーション
\begin{equation}
	R \subseteq [\{D_1 \times D_2 \times D_3\}=\{(1,a,あ),(1,a,い),...,(2,c,い)\}] \label{eq:リレーションドメイン}
\end{equation}
を定義できる．また，リレーションの組の総数を$R$の基数\footnote{濃度,cardinality}，定義されているドメインの個数を次数\footnote{degree}をという．この場合は，$cardinality(R)=12$，$degree(R)=3$である．ドメインに対する名前を属性名\footnote{attribute name，属性}という．ドメイン関数
\begin{eqnarray}
	R \subseteq \{D_i=dom(A_i)\} (i=1,2,...,n)
\end{eqnarray}
と定義できる．表\ref{tbl:リレーションのサンプル}でいうと，式(\ref{eq:リレーションドメイン})より，
\begin{equation}
	R \subseteq \{D_1 \times D_2 \times D_3 = dom(A_1) \times dom(A_2) \times dom(A_3) = dom(数字) \times dom(英字) \times dom(平仮名) \}
\end{equation}
となる．

\subsection{行と列}
リレーション$R$を用いて，テーブル\footnote{表,table}(表\ref{tbl:リレーションのサンプル})を表すことができる．テーブルの横を行\footnote{row．タプルに対応する．}，縦を列\footnote{カラム，column．属性に対応する．}という．
ここで，行の順番には何の情報もない．例として，$(2,b,い),(2,c,あ),(1,a,あ)$となっていても何の問題もない．だが，列の順番は，直積の演算の結果であるため意味があり，この場合，$(1,a,あ)$が，$(あ,1,a)$になるのは，間違いである．
\par また，行数は特に規定が無い限り，無制限に入れられる．リレーションの中身は人間が手動で検索するものでは無く，積極的に閲覧しないものである．検索を行う場合は，必ず質問言語を用いて必要な結果を得る．ここが，MS Excelなどの表計算ソフト等との大きな違いである．
\par だが，リレーションにおいて，同じ行が存在してはならない．リレーション上では，属性の各要素の組み合わせからなる行は，重複しない組み合わせで有る必要がある．例として，$(1,a,あ),(1,b,い),(1,a,あ)$となってはならず，$(1,a,あ)$は唯一の$(1,a,あ)$である．
2行目以上のの同じ行があった場合は，どちらかが間違っているため，リレーションにおいける整合性はなくなってしまう．

\subsection{リレーションスキーマ}
リレーションが持つ，普遍的な構造や意味を抽出したものであり，時間的に常に不変である．例として，表\ref{tbl:友人}でいうと，太郎，一郎，花子，桃子が友人であるのは，この時だけで，翌日には，友人ではなくなる可能性や，新たな友人ができる可能性もある．つまり，リレーションとは時間とともに変化するものである．
しかし，このリレーションが友人のNameとAgeを表していることは，変化しない．この，リレーションの時間に関係なく，不変な性質をリレーションスキーマという．
\par それに対して，一般に時間の移り変わり共に変化するリレーションそのものをリレーションスキーマのインスタンスと呼ぶ．この例では，リレーションスキーマ友人(Name,Age)が定義される．よって，表\ref{tbl:友人}はリレーション友人でのある時刻での友人のインスタンスである．
\par 従って，リレーションスキーマに対して成立しないと行けない事象は全てのインスタンスに成立する．また，その逆も言える．


\section{意味記述}
意味とは，リレーションという形だけでは捕えられない実世界の制約のことだ．例として，表\ref{tbl:リレーション社員}の場合，社員の平均給与は30以上であるという制約は，構造では捕えられない．また，キー制約を用いることで，リレーションを常に一貫性\footnote{実世界と矛盾のない状態}のある状態に保つことが出来る．

\begin{table}[htp]
	\begin{center}
		\begin{tabular}{c}
			\begin{minipage}{0.5\hsize}
				\begin{center}
					\caption{リレーション社員}
					\label{tbl:リレーション社員}
					\begin{tabular}{|c|c|c|c|c|} \hline
						社員番号 & 社員名 & 給与 & 所属 & 郵便番号 \\ \hline \hline
						650  & 鈴木一郎 & 50 & K55 & 805-96 \\ \hline
						1508 & 山田二郎 & 40 & K41 & 814-03 \\ \hline
						231  & 田中三郎 & 60 & K41 & 802-01 \\ \hline
						2034 & 佐藤四郎 & 40 & K55 & 819-98 \\ \hline
						3019 & 山田二郎 & 50 & K41 & 825-43 \\ \hline
						401  & 堂本花子 & 60 & K55 & 814-03 \\ \hline
					\end{tabular}
				\end{center}
			\end{minipage}
			\begin{minipage}{0.5\hsize}
				\begin{center}
					\caption{リレーション納品}
					\label{tbl:リレーション納品}
					\begin{tabular}{|c|c|c|}\hline
						商品番号 & 顧客番号 & 納品数量 \\ \hline \hline
						G1 & C1 & 3  \\ \hline
						G1 & G2 & 10 \\ \hline
						G2 & G2 & 5  \\ \hline
						G2 & G3 & 10 \\ \hline
					\end{tabular}
				\end{center}
			\end{minipage}
		\end{tabular}
	\end{center}
\end{table}

\subsection{キー制約}
RDBでは，データベースの検索や更新に，どの組にアクセスしているのかを一意に指定しなければならない．例として，表\ref{tbl:リレーション社員}の場合，1508の山田二郎の給与を10減らしたくても，名前や所属では2人の山田二郎に共通で当てはまってしまう．そのため，正常な操作を行うことができない．
\subsubsection{スーパーキー}
一般に，いかなるインスタンスにおいても，2つ以上の組が空値\footnote{そらね，Null Value}となる場合を除いて，同一の属性値を持つことがないような，属性あるいは属性の集合である．主キーや候補キーとの違いは，一意に識別できる全ての組み合わせを示す点である．つまり，候補キーに属性をつけて冗長にしたものは，候補キーではないが，スーパーキーではある．
\par 表\ref{tbl:リレーション社員}の場合，スーパーキーは以下のとおりとなる．
\begin{eqnarray}
	\{社員番号\}，\{社員番号,社員名\}，\{社員番号,給与\}，...，\{社員番号,社員名,給与\}， \\
	\{社員番号,社員名,所属\}，...，\{社員番号,社員名,給与,所属,郵便番号\}
\end{eqnarray}



\subsubsection{候補キー}
全体集合のうち，組の一意識別能力を持つ部分集合の極小組を候補キー\footnote{candidate key}という．候補キーは極小であるため，属性を1つでも取り除くと組の一意識別能力を失う．
\par 例として表\ref{tbl:リレーション社員}を考えると，\{社員番号\}が候補キーとなる．また，別の例として，表\ref{tbl:リレーション納品}を考える．この場合は，\{商品番号，顧客番号\}が候補キーとなる．同じ商品を異なる顧客に納品する場合や，同じ顧客に異なる商品を納品することが考えられるからである．




% chapterリレーショナルデータモデル (end)


\end{document}

